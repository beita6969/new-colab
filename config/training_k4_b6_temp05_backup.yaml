# AFlow + ROLL é›†æˆè®­ç»ƒé…ç½®
# ğŸ”¥ K=4, B=6, T=0.5 è´¨é‡ä¼˜å…ˆé…ç½®
# ä¿®æ”¹æ—¶é—´: 2024-11-24
# é…ç½®ç†å¿µ: æ¸©åº¦0.5è´¨é‡ä¼˜å…ˆï¼Œé€šè¿‡æ”¾å®½å…¶ä»–çº¦æŸä¿æŒå¤šæ ·æ€§

# å®éªŒé…ç½®
exp_name: "aflow_grpo_k4_b6_temp05_v1"  # K=4 + T=0.5é…ç½®
output_dir: "checkpoints"
log_dir: "logs"
max_steps: 500
save_every: 50
eval_every: 999999
val_samples: 87
log_every: 5

# =====================================
# GRPOç®—æ³•é…ç½®
# =====================================
adv_estimator: "grpo"
num_return_sequences_in_group: 4  # ğŸ”¥ ä»3â†’4ï¼ˆç»Ÿè®¡ç¨³å®šæ€§æå‡ï¼‰
ppo_epochs: 1
async_generation_ratio: 0
use_kl_loss: true
kl_loss_coef: 0.012                # ğŸ”¥ ä»0.01â†’0.012ï¼ˆT=0.5æ›´ç¡®å®šï¼ŒKLçº¦æŸé€‚ä¸­ï¼‰
clip_range: 0.20                   # ğŸ”¥ ä»0.2â†’0.20ï¼ˆä¿æŒæ ‡å‡†å€¼ï¼‰
gamma: 1.0
lambda_gae: 0.95

# =====================================
# Batché…ç½®
# =====================================
rollout_batch_size: 6              # ğŸ”¥ ä»8â†’6ï¼ˆä¿æŒ24æ ·æœ¬/stepï¼‰
prompt_max_length: 3072
response_max_length: 5120

# æ¨¡å‹é…ç½®
base_model: "/home/yijia/verl-agent/models/qwen/Qwen2___5-7B-Instruct"
model_dtype: "bfloat16"

# =====================================
# LoRAé…ç½®
# =====================================
use_lora: true
lora_rank: 64
lora_alpha: 64
lora_target_modules: "q_proj,k_proj,v_proj,o_proj"
lora_dropout: 0.05

# =====================================
# è®­ç»ƒå‚æ•°ï¼ˆé’ˆå¯¹T=0.5ä¼˜åŒ–ï¼‰
# =====================================
learning_rate: 4.5e-6              # ğŸ”¥ ä»5.0e-6â†’4.5e-6ï¼ˆT=0.5æ›´ç¨³å®šï¼Œç•¥æé«˜ï¼‰
weight_decay: 0.01
max_grad_norm: 0.5
gradient_accumulation_steps: 3     # ğŸ”¥ ä»2â†’3ï¼ˆæœ‰æ•ˆbatch=72æ ·æœ¬ï¼‰
warmup_steps: 50                   # ğŸ”¥ ä¿æŒ50ï¼ˆT=0.5æ”¶æ•›å¿«ï¼‰
bf16: true
gradient_checkpointing: false

# GPUé…ç½®
device_mapping: [0]
physical_gpus: [2]
protected_pids: []
num_gpus: 1
world_size: 1

# æ•°æ®é›†é…ç½®
data_dir: "data"
train_dataset: "11/integrated_aflow_roll/data/ready_to_train/train_final_clean.jsonl"
val_dataset: "11/integrated_aflow_roll/data/ready_to_train/test.jsonl"
test_dataset: "11/integrated_aflow_roll/data/ready_to_train/test.jsonl"

# æ··åˆé‡‡æ ·æ¯”ä¾‹
domain_ratios:
  math: 0.4
  code: 0.3
  qa: 0.3

# AFlowé…ç½®
aflow_config_path: "config/aflow_llm.yaml"
aflow_executor_model: "gpt-oss-120b"
aflow_operators: ["Custom", "AnswerGenerate", "Programmer", "ScEnsemble", "Test", "Review", "Revise"]
aflow_operator_descriptions_path: "/home/yijia/.claude/11/AFlow/workspace/MATH/workflows/template/operator.json"
execution_timeout: 600

# =====================================
# å¥–åŠ±é…ç½®ï¼ˆä¿æŒåŸå€¼ï¼‰
# =====================================
reward_weights:
  correctness: 0.65
  efficiency: 0.15
  simplicity: 0.10
  format: 0.05
  repetition: 0.05

# æç¤ºè¯ä¼˜åŒ–ç³»ç»Ÿ
experience_buffer:
  enabled: true
  buffer_size: 100
  reward_threshold: 8.0
  persistence_dir: "data/experience_buffer"

prompt_optimizer:
  enabled: true
  few_shot_k: 3
  similarity_threshold: 0.7

operator_prompt_enhancer:
  enabled: true
  top_k_examples: 2

# ç›‘æ§é…ç½®
wandb:
  enabled: true
  project: "agent-prompt"
  entity: "yao110002-sdfsdfsdfsdf-com"
  api_key: "b42ca0000cf06f97b05eba34f58823ad5f3122a4"
  run_name: null

# =====================================
# Temperatureè°ƒåº¦ï¼ˆç¦ç”¨ï¼‰
# =====================================
temperature_schedule:
  enabled: false
  initial: 0.5
  final: 0.5
  warmup_steps: 0

# =====================================
# ç”Ÿæˆé…ç½®ï¼ˆæ ¸å¿ƒï¼šæ¸©åº¦0.5ï¼‰
# =====================================
generation_config:
  temperature: 0.5                 # ğŸ”¥ æ¸©åº¦0.5ï¼ˆè´¨é‡ä¼˜å…ˆï¼‰
  top_p: 0.92                      # ğŸ”¥ ä»0.95â†’0.92ï¼ˆç•¥ä¸¥æ ¼ï¼Œè¡¥å¿T=0.5ï¼‰
  top_k: 45                        # ğŸ”¥ ä»50â†’45ï¼ˆé€‚ä¸­å€™é€‰æ± ï¼‰
  max_new_tokens: 4096
  do_sample: true

# è°ƒè¯•é€‰é¡¹
debug: false
verbose: true
